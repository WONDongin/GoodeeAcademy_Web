<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>주식차트게임</title>
        <script src="workspace/jquery/resource/jquery-3.7.1.min.js"></script>
        <style>
            @font-face {font-family: 'GmarketSansMedium'; src: url('https://fastly.jsdelivr.net/gh/projectnoonnu/noonfonts_2001@1.1/GmarketSansMedium.woff') format('woff'); font-weight: normal;font-style: normal;}
            *{margin: 0; padding: 0; font-family: 'GmarketSansMedium'; font-weight: normal; font-size: 16px; color: #333; letter-spacing: -0.05rem; box-sizing: border-box;}
            #wrap{max-width: 1200px; width: 100%; margin: 0 auto; padding: 50px 0;}
            #main{position:relative; width: 100%; height: 500px; border: 2px solid #333; overflow: hidden; border-radius: 5px;}
            #main .cnt{position: absolute; left: 20px; top: 20px; width: 100px; height: 30px; padding: 5px; border: 1px solid #bebebe;}
            #nav{width: 100%; height: 50px; display: flex; align-items: center; justify-content: space-between;  margin-top: 30px;}
            #nav .stock{width: 150px; height: 100%; padding: 5px;border: 1px solid #bebebe;}
            #nav .start_btn{width: 150px; height: 100%; border: 1px solid #333; background-color: #f7f7f7; cursor: pointer;}
            #nav .start_btn:hover{background-color: #333; color: #fff;transition: 0.3s ease-in;}
            #nav .box{height: 100%; display: flex; align-items: baseline; gap: 10px; vertical-align:middle;}
            #nav .box input{width: 100px; height: 100%; padding: 5px; border: 1px solid #bebebe;} 
            
            #main span{display: block; border: 1px solid #333;}
        </style>
    </head>
    <body>
        <div id="wrap">
            <div id="main">
                <select class="cnt">
                    <option value="1">5분 봉</option>
                    <option value="3">10분 봉</option>
                    <option value="10">30분 봉</option>
                </select>
            </div>

            <div id="nav">
                <select name="stock" class="stock">
                    <option value="넥슨게임즈">넥슨게임즈</option>
                    <option value="위메이드">위메이드</option>
                    <option value="펄어비스">펄어비스</option>
                </select>

                <button class="start_btn" type="button" onclick="game();">시작</button>

                <div class="box"><span>시드 :</span><input type="text" id="seed" value="10000"></div>
                <div class="box"><span>현재주가 :</span><input type="text" id="num1" value="12000"></div>
                <div class="box"><span>수익률 :</span><input type="text" id="num2" value="0"></div>
                <div class="box"><span>평가금액 :</span><input type="text" id="num3" value="0"></div>
            </div>
        </div>

        <script>
            let rate = document.getElementById("num2").value;
            let canvasWidth = 1200;
            let canvasHeight = 500;
            let charts = []; // 차트 객체 저장 배열
            let interval; // setInterval()을 사용할 때 인터벌 ID를 저장하는 변수

            // 상승/하락 여부 결정 (50% 확률)
            function getChangeAmount(chartY) {
                let isUp = Math.random() < 0.5; // 50% 확률로 상승/하락 결정
                let rate = Math.floor(Math.random() * 15) + 1; // 0~15% 
                document.getElementById("num2").value = rate;
                console.log(rate);




                // let change = (canvasHeight * (rate / 100)); // 비율에 따른 변화량
                let change = rate*10; 
                let newY = isUp ? chartY - change : chartY + change;
                return Math.max(0, Math.min(canvasHeight - 100, newY)); // 화면 밖으로 벗어나지 않게 제한
            }

            // 차트 생성 함수
            function createChart(chartY) {
                let newChart = document.createElement("span");
                newChart.style.position = 'absolute';
                newChart.style.width = '20px';
                newChart.style.height = '100px';
                newChart.style.backgroundColor = 'red';

                let x = charts.length * 40; // 차트의 x 좌표
                let y = chartY !== undefined ? getChangeAmount(chartY) : 250; // 첫 차트는 기본값 사용
                newChart.style.transform = `translate(${x}px, ${y}px)`;

                document.querySelector("#main").appendChild(newChart);
                return y; // 생성된 차트의 y값 반환(다음 차트 기준)
            }

            // 게임 시작 함수
            function game() {
                let count = parseInt(document.querySelector(".cnt").value); // 생성할 차트 개수
                let createdCount = 0;
                let chartY = 250; // 첫 차트의 기본 Y값
            
                // if (interval) clearInterval(interval); // 기존 실행 중인 인터벌 중지
            
                interval = setInterval(() => {
                    if (createdCount < count) {
                        chartY = createChart(chartY); // 차트 생성 및 y값 갱신
                        charts.push(chartY);
                        createdCount++;



                        
                    } else {
                        clearInterval(interval);
                    }
                }, 100);
            
               
            }
        </script>
    </body>
</html>